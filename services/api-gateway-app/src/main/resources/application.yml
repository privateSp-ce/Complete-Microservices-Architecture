spring:
  application:
    name: api-gateway-app
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      routes:
        # ===================================
        # USER SERVICE ROUTES
        # ===================================
        - id: user-service-auth
          uri: lb://USER-SERVICE-APP
          predicates:
            - Path=/api/v1/auth/**

        - id: user-service-users
          uri: lb://USER-SERVICE-APP
          predicates:
            - Path=/api/v1/users/**

        # ===================================
        # RESTAURANT SERVICE ROUTES
        # ===================================
        - id: restaurant-service
          uri: lb://RESTAURANT-SERVICE-APP
          predicates:
            - Path=/api/v1/restaurants/**

        # ===================================
        # CART SERVICE ROUTES
        # ===================================
        - id: cart-service
          uri: lb://CART-SERVICE-APP
          predicates:
            - Path=/api/v1/cart/**

        # ===================================
        # ORDER SERVICE ROUTES
        # ===================================
        - id: order-service
          uri: lb://ORDER-SERVICE-APP
          predicates:
            - Path=/api/v1/orders/**

        # ===================================
        # PAYMENT SERVICE ROUTES
        # ===================================
        - id: payment-service
          uri: lb://PAYMENT-SERVICE-APP
          predicates:
            - Path=/api/v1/payments/**

        # ===================================
        # OPENAPI DOCS ROUTES
        # ===================================
        - id: openapi-user
          uri: lb://USER-SERVICE-APP
          predicates:
            - Path=/user-service/v3/api-docs
          filters:
            - RewritePath=/user-service/v3/api-docs, /v3/api-docs

        - id: openapi-restaurant
          uri: lb://RESTAURANT-SERVICE-APP
          predicates:
            - Path=/restaurant-service/v3/api-docs
          filters:
            - RewritePath=/restaurant-service/v3/api-docs, /v3/api-docs

        - id: openapi-cart
          uri: lb://CART-SERVICE-APP
          predicates:
            - Path=/cart-service/v3/api-docs
          filters:
            - RewritePath=/cart-service/v3/api-docs, /v3/api-docs

        - id: openapi-order
          uri: lb://ORDER-SERVICE-APP
          predicates:
            - Path=/order-service/v3/api-docs
          filters:
            - RewritePath=/order-service/v3/api-docs, /v3/api-docs

        - id: openapi-payment
          uri: lb://PAYMENT-SERVICE-APP
          predicates:
            - Path=/payment-service/v3/api-docs
          filters:
            - RewritePath=/payment-service/v3/api-docs, /v3/api-docs

server:
  port: 9000

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
  instance:
    prefer-ip-address: true

management:
  zipkin:
    tracing:
      endpoint: http://localhost:9411/api/v2/spans
  tracing:
    enabled: true
    sampling:
      probability: 1.0
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
    prometheus:
      access: read_only
  metrics:
    tags:
      application: ${spring.application.name}
    distribution:
      percentiles-histogram:
        http.server.requests: true
  prometheus:
    metrics:
      export:
        enabled: true

springdoc:
  swagger-ui:
    urls-primary-name: API Documentation
    enabled: true
    urls:
      - name: User Service
        url: /user-service/v3/api-docs
      - name: Restaurant Service
        url: /restaurant-service/v3/api-docs
      - name: Cart Service
        url: /cart-service/v3/api-docs
      - name: Order Service
        url: /order-service/v3/api-docs
      - name: Payment Service
        url: /payment-service/v3/api-docs

logging:
  pattern:
    level: "%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]"
